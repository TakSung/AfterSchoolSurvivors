# 야구 배트 통합 테스트 계획

**날짜**: 2025년 10월 11일
**대상**: `BaseballBat` 무기 시스템 (`ItemSystem`, `PlayerAttackSystem`, `CollisionSystem` 연동)
**복잡도**: 중간 (계획 문서 우선 작성)

## AI 분석 및 사용자 요구사항 요약

### 1. 비즈니스 로직 (사용자 확인 완료)
- **핵심 로직**: 현재 게임 시스템은 야구배트(사각형)를 물리적으로 회전시키는 대신, **순간적인 부채꼴 모양의 판정 영역(`HitboxComponent`)**을 생성하여 공격을 효율적으로 시뮬레이션합니다.
- **판정 방식**: 이 보이지 않는 부채꼴 영역이 짧은 시간 동안 유지되며, `CollisionSystem`이 해당 영역 내의 모든 적에게 동시에 피해를 적용합니다.
- **사용자 경험**: 플레이어는 배트를 휘두르는 듯한 경험을 하지만, 내부적으로는 성능에 최적화된 범위 공격으로 처리됩니다. 테스트는 이 **'부채꼴 시뮬레이션'** 로직을 기준으로 합니다.

### 2. 검증 요구사항 (사용자 확인 완료)
#### 테스트 시나리오
- **레벨 5 (360도) 공격**: 플레이어의 전후좌우 모든 방향에 있는 적들이 타격되는지 검증합니다.
- **공격 속도 증가**: 레벨 2와 4에서 공격 속도가 실제로 증가하는지 확인합니다.
- **범위 내/외부 판정**: 부채꼴 공격 범위의 안, 밖, 경계선에 있는 적들을 정확히 구분하여 타격하는지 검증합니다.
- **빈 화면 공격**: 화면에 적이 없을 때에도 공격이 에러 없이 정상적으로 수행되는지 확인합니다.

#### 개발자 가정 (테스트 범위에서 제외)
- `BaseballBat.level`은 항상 1에서 5 사이의 값만 가집니다.
- `HitboxComponent.duration`은 항상 0보다 큰 유효한 값입니다.
- `AttackComponent.damage`는 항상 0 또는 양수의 값입니다.

---

## 테스트 방안

### 방안 1: 완전한 시각적 통합 테스트 (Pygame 시뮬레이션)
- **복잡성**: ⭐⭐⭐ (높음)
- **핵심 기능 연관성**: ⭐⭐⭐ (매우 높음)
- **테스트 독립성**: ⭐⭐☆ (중간)
- **설명**: 실제 게임처럼 Pygame 창에 플레이어와 적들을 배치하고, 마우스 조작에 따라 공격이 발동되도록 합니다. 레벨별로 야구 배트의 공격 범위(부채꼴)가 시각적으로 렌더링되고, 적들이 정확히 타격되는지 눈으로 직접 확인할 수 있습니다. 테스트 종료 후 적의 체력 감소 등을 `assert`로 검증합니다.
- **선호도**: 최초 사용자 요청에 가장 부합하는 방안.

### 방안 2: 시스템 로직 테스트 (렌더링 없음)
- **복잡성**: ⭐⭐☆ (중간)
- **핵심 기능 연관성**: ⭐⭐⭐ (매우 높음)
- **테스트 독립성**: ⭐⭐⭐ (매우 높음)
- **설명**: 그래픽 없이 순수하게 `ItemSystem`, `PlayerAttackSystem`, `CollisionSystem`의 상호작용만 검증합니다. 메모리상에 플레이어와 적을 생성하고, 시스템 `update`를 순차적으로 호출합니다. 공격 후 적의 `HealthComponent`가 올바르게 감소했는지를 `assert`로만 확인합니다. 실행 속도가 빠릅니다.

### 방안 3: 히트박스 판정 집중 테스트
- **복잡성**: ⭐☆☆ (낮음)
- **핵심 기능 연관성**: ⭐⭐☆ (중간)
- **테스트 독립성**: ⭐⭐⭐ (매우 높음)
- **설명**: `CollisionSystem`의 부채꼴 판정 로직만 집중적으로 검증합니다. 부채꼴 범위의 안, 밖, 경계선에 적을 배치한 후, `CollisionSystem`을 한 번 실행하여 정확한 적들만 타격 판정을 받는지 확인합니다. 공격 속도나 아이템 레벨업 등의 다른 로직은 제외하고 오직 충돌 판정의 정확성만 검증합니다.

---

## 다음 단계
- 작성된 계획을 바탕으로 **방안 1**을 채택하여 `tests/total/system/test_weapons_item.py` 파일에 시각적 통합 테스트 코드를 구현합니다.
